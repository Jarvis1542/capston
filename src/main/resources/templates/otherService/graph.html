<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/layout :: head"/>
<body>
<header th:replace="layout/layout :: header"/>
<!-- bradcam_area  -->
<div class="bradcam_area hp_bg_06">
    <div class="container">
        <div class="row">
            <div class="col-xl-12">
                <div class="bradcam_text">
                    <h3>GRAPH ROOM</h3>
                </div>
            </div>
        </div>
    </div>
</div>

<div>
    <select name="year" id="year">
        <option value="year2020" selected="selected">2020년</option>
        <option value="year2019">2019년</option>
        <option value="year2018">2018년</option>
    </select>
    <select name="month" class="month">
        <option value="yearAll" selected="selected">월</option>
        <option value="month01">1월</option>
        <option value="month02">2월</option>
        <option value="month03">3월</option>
        <option value="month04">4월</option>
        <option value="month05">5월</option>
        <option value="month06">6월</option>
        <option value="month07">7월</option>
        <option value="month08">8월</option>
        <option value="month09">9월</option>
        <option value="month10">10월</option>
        <option value="month11">11월</option>
        <option value="month12">12월</option>
    </select>
    <select name="week">
        <option value="monthAll" selected="selected">주간</option>
        <option value="week1">1주</option>
        <option value="week2">2주</option>
        <option value="week3">3주</option>
        <option value="week4">4주</option>
        <option value="week5">5주</option>
    </select>
    <button type="button" class="lookup">조회</button>
</div>

<div style="width:80%; height: 100%; border: solid 1px black; margin-left: 10%; margin-top:30px;">
    <canvas id="myChart"></canvas>
</div>

<hr>
<div style="width:80%; height: 100%; border: solid 1px black; margin-left: 10%; margin-top:30px;">
    <canvas id="myChart2"></canvas>
</div>
<hr>
<div style="width:80%; height: 100%; border: solid 1px black; margin-left: 10%; margin-top:30px;">
    <canvas id="myChart3"></canvas>
</div>


<footer th:replace="layout/layout :: footer"/>
</body>
<script th:replace="layout/layout :: script"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

<script>
    var select_inner = "";
    $(".month").click(function() {
        for(var i = 0; i < 12; i++) {
            if ($(".month").val() == cnt_month[i]) {
                for(var j = 1; j <= cnt_month[j]; j++) {
                    //select_inner;
                }
            }
        }
    });
    $.ajax({
        method: "post",
        url: "/rest/GraphList"
    })
    .done(function( msg ) {
        //console.log(msg[0].create_date.getMonth());
        var date_arr = [];
        for(var j = 0; j < 12; j++) {
            date_arr[j] = 0;
        }
        for(var i = 0; i < msg.length; i++) {
            var month = new Date(msg[i].create_date);
            if(month.getMonth()+1 == 12) {
                date_arr[11] += 1;
            } else if(month.getMonth()+1 == 11) {
                date_arr[10] += 1;
            } else if(month.getMonth()+1 == 10) {
                date_arr[9] += 1;
            } else if(month.getMonth()+1 == 9) {
                date_arr[8] += 1;
            } else if(month.getMonth()+1 == 8) {
                date_arr[7] += 1;
            } else if(month.getMonth()+1 == 7) {
                date_arr[6] += 1;
            } else if(month.getMonth()+1 == 6) {
                date_arr[5] += 1;
            } else if(month.getMonth()+1 == 5) {
                date_arr[4] += 1;
            } else if(month.getMonth()+1 == 4) {
                date_arr[3] += 1;
            } else if(month.getMonth()+1 == 3) {
                date_arr[2] += 1;
            } else if(month.getMonth()+1 == 2) {
                date_arr[1] += 1;
            } else if(month.getMonth()+1 == 1) {
                date_arr[0] += 1;
            }
        }
        console.log(date_arr + "ㅇㄷ갔누");

        var ctx = document.getElementById('myChart').getContext('2d');
        var chart = new Chart(ctx, {
            // The type of chart we want to create
            type: 'bar',

            // The data for our dataset
            data: {
                labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
                datasets: [{
                    label: '2020년 가입자 통계',
                    backgroundColor: 'rgb(62,147,0)',
                    borderColor: 'rgb(64,64,64)',
                    data: [date_arr[0], date_arr[1], date_arr[2], date_arr[3], date_arr[4], date_arr[5], date_arr[6],
                        date_arr[7], date_arr[8], date_arr[9], date_arr[10], date_arr[11]]
                }]
            },

            // Configuration options go here
            options: {}
        });
        //console.log(d.getMonth() + 1);
        //console.log( "Data Saved : ", msg );
    }).fail(function (error) {
        alert("에러 : " + error);
    });

    var ctx2 = document.getElementById('myChart2').getContext('2d');
    var chart2 = new Chart(ctx2, {
        // The type of chart we want to create
        type: 'line',

        // The data for our dataset
        data: {
            labels: ['2018', '2019', '2020'],
            datasets: [{
                label: '전기차 매출 현황',
                fill: false,
                borderColor: 'rgb(48,208,238)',
                data: [3, 7, 18,],
                lineTension: 0.1
            }]
        },

        // Configuration options go here
        options: {}
    });

    var week_52 = [];
    var week_match = [];
    var cnt_month = [];
    var cnt = 0;
    // 여기임!!!!!!!!!
    $.ajax({
        method: "post",
        url: "/rest/weekList"
    })
        .done(function( msg ) {
            var year = $("#year option:selected").text();
            year = year.replace("년","");
            year += "-01-01";
            var curr = new Date(year); // get current date
            var first = curr.getDate() - curr.getDay(); // First day is the day of the month - the day of the week
            var last = first + 6; // last day is the first day + 6

            var firstday = new Date(curr.setDate(first)).toUTCString();
            var lastday = new Date(curr.setDate(last)).toUTCString();

            for(var k = 0; k <= 11; k++) {
                cnt_month[k] = 0;
            }
            for(var j = 1; j <= 52; j++) {
                week_match[j] = 0;
                firstday = new Date(addDays(firstday, 7));
            }
            console.log("week_52", week_52);
            for(var m = 0; m < week_52.length; m++) {
                for (var a = 0; a < 12; a++) {
                    if (week_52[m].getMonth() + 1 == a + 1) {
                        console.log("몇번 들어오냐 ㅅㅂ");
                        cnt_month[a] += 1;
                    }
                }
            }
            for(var i = 0; i < msg.length; i++) {
                var day = new Date(msg[i].week_FIRST);
                /*
                console.log("day : " + day);
                console.log("day getDate : " + day.getDate());
                */

                for(var m = 0; m < week_52.length; m++) {
                    if(week_52[m].getMonth()+1 == day.getMonth()+1 && week_52[m].getDate() == day.getDate() - 1) {
                        /*
                        console.log("M : " + m);
                        console.log("week__52 getDATE : " + week_52[m].getDate());
                        console.log("week__52 getMonth : " + week_52[m].getMonth());
                        console.log("day getDate : " + day.getDate());
                        console.log("day getMonth : " + day.getMonth());
                         */
                        week_match[m] += 1;
                    }
                }
                //var d = new Date(msg[i].create_date);

            }
            //console.log("week_match", week_match);
            console.log("cnt_month : " + cnt_month);
            for(var b = 0; b < 12; b++) {

            }
            // 일주일 가입자 그래프
            var ctx3 = document.getElementById('myChart3').getContext('2d');
            var chart3 = new Chart(ctx3, {
                // The type of chart we want to create
                type: 'bar',

                // The data for our dataset
                data: {
                    labels: ['일', '월', '화', '수', '목', '금', '토'],
                    datasets: [{
                        label: '주간 가입자 통계',
                        backgroundColor: 'rgb(255,171,45)',
                        borderColor: 'rgb(64,64,64)',
                        data: [2, 10, 5, 2, 20, 30, 45]
                    }]
                },

                // Configuration options go here
                options: {}
            });
            console.log("맞나 :", msg);
        }).fail(function (error) {
        console.log("에러 : ", error);
    });

    function addDays(date, days) {
        var result = new Date(date);
        result.setDate(result.getDate() + days);
        week_52[cnt] = result;
        cnt++;
        return result;
    }




</script>
</html>
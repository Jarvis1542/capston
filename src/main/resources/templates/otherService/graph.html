<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/layout :: head"/>
<body>
<header th:replace="layout/layout :: header"/>
<!-- bradcam_area  -->
<div class="bradcam_area hp_bg_06">
    <div class="container">
        <div class="row">
            <div class="col-xl-12">
                <div class="bradcam_text">
                    <h3>GRAPH ROOM</h3>
                </div>
            </div>
        </div>
    </div>
</div>

<div>
    <select name="year">
        <option value="year2020" selected="selected">2020년</option>
        <option value="year2019">2019년</option>
        <option value="year2018">2018년</option>
    </select>
    <select name="month">
        <option value="yearAll" selected="selected">년도 전체</option>
        <option value="month01">1월</option>
        <option value="month02">2월</option>
        <option value="month03">3월</option>
        <option value="month04">4월</option>
        <option value="month05">5월</option>
        <option value="month06">6월</option>
        <option value="month07">7월</option>
        <option value="month08">8월</option>
        <option value="month09">9월</option>
        <option value="month10">10월</option>
        <option value="month11">11월</option>
        <option value="month12">12월</option>
    </select>
    <select name="week">
        <option value="monthAll" selected="selected">월 전체</option>
        <option value="week1">1주</option>
        <option value="week2">2주</option>
        <option value="week3">3주</option>
        <option value="week4">4주</option>
        <option value="week5">5주</option>
    </select>
</div>

<div style="width:80%; height: 100%; border: solid 1px black; margin-left: 10%; margin-top:30px;">
    <canvas id="myChart"></canvas>
</div>

<hr>
<div style="width:80%; height: 100%; border: solid 1px black; margin-left: 10%; margin-top:30px;">
    <canvas id="myChart2"></canvas>
</div>
<hr>
<div style="width:80%; height: 100%; border: solid 1px black; margin-left: 10%; margin-top:30px;">
    <canvas id="myChart3"></canvas>
</div>


<footer th:replace="layout/layout :: footer"/>
</body>
<script th:replace="layout/layout :: script"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

<script>

    $.ajax({
        method: "post",
        url: "/rest/GraphList"
    })
    .done(function( msg ) {
        //console.log(msg[0].create_date.getMonth());
        var date_arr = [];
        for(var j = 0; j < 12; j++) {
            date_arr[j] = 0;
        }
        for(var i = 0; i < msg.length; i++) {
            var d = new Date(msg[i].create_date);
            if(d.getMonth()+1 == 12) {
                date_arr[11] += 1;
            } else if(d.getMonth()+1 == 11) {
                date_arr[10] += 1;
            } else if(d.getMonth()+1 == 10) {
                date_arr[9] += 1;
            } else if(d.getMonth()+1 == 9) {
                date_arr[8] += 1;
            } else if(d.getMonth()+1 == 8) {
                date_arr[7] += 1;
            } else if(d.getMonth()+1 == 7) {
                date_arr[6] += 1;
            } else if(d.getMonth()+1 == 6) {
                date_arr[5] += 1;
            } else if(d.getMonth()+1 == 5) {
                date_arr[4] += 1;
            } else if(d.getMonth()+1 == 4) {
                date_arr[3] += 1;
            } else if(d.getMonth()+1 == 3) {
                date_arr[2] += 1;
            } else if(d.getMonth()+1 == 2) {
                date_arr[1] += 1;
            } else if(d.getMonth()+1 == 1) {
                date_arr[0] += 1;
            }
        }
        console.log(date_arr + "ㅇㄷ갔누");

        var ctx = document.getElementById('myChart').getContext('2d');
        var chart = new Chart(ctx, {
            // The type of chart we want to create
            type: 'bar',

            // The data for our dataset
            data: {
                labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
                datasets: [{
                    label: '2020년 가입자 통계',
                    backgroundColor: 'rgb(62,147,0)',
                    borderColor: 'rgb(64,64,64)',
                    data: [date_arr[0], date_arr[1], date_arr[2], date_arr[3], date_arr[4], date_arr[5], date_arr[6],
                        date_arr[7], date_arr[8], date_arr[9], date_arr[10], date_arr[11]]
                }]
            },

            // Configuration options go here
            options: {}
        });
        //console.log(d.getMonth() + 1);
        //console.log( "Data Saved : ", msg );
    }).fail(function (error) {
        alert("에러 : " + error);
    });

    var ctx2 = document.getElementById('myChart2').getContext('2d');
    var chart2 = new Chart(ctx2, {
        // The type of chart we want to create
        type: 'line',

        // The data for our dataset
        data: {
            labels: ['2018', '2019', '2020'],
            datasets: [{
                label: '전기차 매출 현황',
                fill: false,
                borderColor: 'rgb(48,208,238)',
                data: [3, 7, 18,],
                lineTension: 0.1
            }]
        },

        // Configuration options go here
        options: {}
    });


    // 여기임!!!!!!!!!
    $.ajax({
        method: "post",
        url: "/rest/weekList"
    })
        .done(function( msg ) {
            for(var i = 0; i < msg.length; i++) {
                console.log(msg[i].week_FIRST);


                //var d = new Date(msg[i].create_date);

            }
            // 일주일 가입자 그래프
            var ctx3 = document.getElementById('myChart3').getContext('2d');
            var chart3 = new Chart(ctx3, {
                // The type of chart we want to create
                type: 'bar',

                // The data for our dataset
                data: {
                    labels: ['일', '월', '화', '수', '목', '금', '토'],
                    datasets: [{
                        label: '주간 가입자 통계',
                        backgroundColor: 'rgb(255,171,45)',
                        borderColor: 'rgb(64,64,64)',
                        data: [2, 10, 5, 2, 20, 30, 45]
                    }]
                },

                // Configuration options go here
                options: {}
            });
            console.log("맞나 :", msg);
        }).fail(function (error) {
        console.log("에러 : ", error);
    });



</script>
</html>